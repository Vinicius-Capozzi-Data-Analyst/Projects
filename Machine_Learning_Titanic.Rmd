---
title: "Machine Learning Titanic"
author: "Vinicius Capozzi"
output: html_document
---
### Nesse arquivo, veremos um exemplo de como uma decision tree(árvore de desição) consegue identificar padrões com base nas observações da base de treino e assim predizer quais pessoas foram sobrevivente no acidente.
```{r, message=FALSE, warning=FALSE}
# Instalação de pacotes
pacotes <- c('titanic',    # carrega a base original titanic_treino 
             'tidyverse',  # Pacote básico de datawrangling
             'rpart',      # Biblioteca de árvores
             'rpart.plot', # Conjunto com Rpart, plota a parvore
             'gtools',     # funções auxiliares como quantcut,
             'Rmisc',      # carrega a função sumarySE para a descritiva
             'scales',     # importa paletas de cores
             'caret',      # Funções úteis para machine learning
             'plotly'      # Biblioteca p/ plotagem de gráficos
             
             )

if(sum(as.numeric(!pacotes %in% installed.packages())) != 0){
  instalador <- pacotes[!pacotes %in% installed.packages()]
  for(i in 1:length(instalador)) {
    install.packages(instalador, dependencies = T)
    break()}
  sapply(pacotes, require, character = T) 
} else {
  sapply(pacotes, require, character = T) 
}

```

### Vamos trabalhar com a base titanic


```{r}
load("C:/Users/Vinicius/Desktop/MBA/Outros Modelos de Machine Learning/.RData")
titanic %>% head

```
### Com a função summary, vemos algumas estatíscas descritivas da nossa base de dados que podem nos ajudar a entender melhor como as observações estão distribuídas. 
```{r}
summary(titanic)
titanic %>% str
```
### Em seguida, plotaremos alguns gráficos que irão nos dar uma visão melhor sobre as variáveis da nossa base de dados. As variáveis que achei mais interessante destacar foram Sexo, Idade e o número da Classe do passageiro.
```{r}
graf1 <- plot_ly(x=titanic$Sex, type = 'histogram') %>% layout(title = 'Sexo')
graf1
graf2 <- hist(titanic$Age, col = 'red', main = "Histograma da Idade")
graf3 <- hist(titanic$Pclass, col = 'lightgray', main = "Histograma da Classe")


```

### Aqui geramos a variável "arvore" que irá conter a nossa árvore. Com base no primeiro argumento que passomos na função, no caso se a pessoa é uma sobrevivente ou não, o algoritmo irá testar qual das outras variáveis melhor se relaciona com o fato da pessoa ter sobrevivido, como o sexo, a idade, a classe. 
```{r}
arvore <- rpart(Survived ~ Pclass + Sex + Age + SibSp + Parch + Fare + Embarked,
                data=titanic,
                parms = list(split = 'gini'), # podemos trocar para  'information'
                method='class' # Essa opção indica que a resposta é qualitativa
)
rpart.plot::rpart.plot(arvore
                       )
```
```{r}
prob = predict(arvore, titanic)
class = prob[,2]>.5
tab <- table(class, titanic$Survived)
tab
df <- as.data.frame(prob)
survived <- filter(df, Y>0.5)
not_survived <- filter(df, Y<0.5)
acc <- (tab[1,1] + tab[2,2])/ sum(tab)
print(paste0('O modelo apresentou ',  nrow(survived) ,' sobreviventes'))
print(paste0('O modelo apresentou ',  nrow(not_survived) ,' não sobreviventes'))
print(paste0('A acurácia foi de:', acc))

```

